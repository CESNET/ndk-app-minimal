/*
 * comp.jenkins: Jenkins configuration script
 * Copyright (C) 2023 CESNET z. s. p. o.
 * Author(s): Daniel Kriz <danielkriz@cesnet.cz>
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

// Clean previous builds
library 'liberouter'
cleanBuilds()

// /////////////////////////////////////////////////////////////////////////////
// BASIC-VERIFICATION
// /////////////////////////////////////////////////////////////////////////////
// Add engines for automatic Jenkins verifications into the following list
// FORMAT:
//  [ 'name',               'path_to_ver',                          'script.fdo'   ],
def COMPONENTS_VER = [\
    ['NETWORK_MOD_LOGIC' , 'ndk/core/intel/src/comp/network_mod/comp/network_mod_logic/uvm', 'top_level.fdo'],\
]
// /////////////////////////////////////////////////////////////////////////////

// /////////////////////////////////////////////////////////////////////////////
// MULTI-VERIFICATION
// /////////////////////////////////////////////////////////////////////////////
// Add engines for automatic Jenkins verifications into the following list
// FORMAT:
//  [ 'name'             ,'path_to_ver'                                                               ,'fdo_file.fdo'              ,'test_pkg.sv/.vhd'     ,'settings.py'            ]
def COMPONENTS_MULTIVER = [\
    ['DMA_TRANS_ACCU'    ,'ndk/modules/ndk-mod-dma-medusa/rx/comp/dma_endpoint/comp/trans_accu/ver'   ,'top_level.fdo'             ,'tbench/test_pkg.sv'   ,'ver_settings.py'        ],\
    ['PCIE_ADAPTERS'     ,'ndk/core/intel/src/comp/pcie/comp/pcie_adapter/uvm'                        ,'top_level.fdo'             ,'tbench/tests/pkg.sv'  ,'ver_settings.py'        ],\
    ['PCIE_ADAPTERS'     ,'ndk/core/intel/src/comp/pcie/comp/pcie_adapter/uvm'                        ,'top_level.fdo'             ,'tbench/tests/pkg.sv'  ,'ver_settings.py'        ],\
    ['PCIE_INTEL_PTILE'  ,'ndk/core/intel/src/comp/pcie//uvm'                                         ,'top_level_intel_ptile.fdo' ,'tbench/tests/pkg.sv'  ,'ver_settings_intel.py'  ],\
    ['PCIE_XILINX'       ,'ndk/core/intel/src/comp/pcie//uvm'                                         ,'top_level_xilinx.fdo'      ,'tbench/tests/pkg.sv'  ,'ver_settings_xilinx.py' ],\
]
 /////////////////////////////////////////////////////////////////////////////

// Run component verifications using common script
node('preklad') {
    // fetch sources from GIT
    checkout scm
    def common_run = load "ndk/ofm/tests/jenkins/common.jenkins"
    common_run.commonPrekladVerRun(COMPONENTS_VER)
    def root_path  = pwd()
    common_run.commonPrekladMultiVerRun(COMPONENTS_MULTIVER, "$root_path/ndk/ofm")
}

